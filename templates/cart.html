{% extends base_template %}
{% block contenido %}
<style>
.pedido-titulo {
	color: #b30000;
	font-size: 2.2rem;
	font-weight: bold;
	text-align: center;
	margin-bottom: 30px;
}
.pedido-titulo i {
	font-size: 2.2rem;
	vertical-align: middle;
}
.carrito-item {
	display: flex;
	align-items: center;
	justify-content: space-between;
	border-bottom: 1px solid #eee;
	padding: 18px 0 10px 0;
	max-width: 600px;
	margin: 0 auto;
}
.carrito-nombre {
	font-weight: bold;
	font-size: 1.1rem;
	flex: 1;
}
.carrito-cantidad {
	display: flex;
	align-items: center;
	gap: 4px;
}
.carrito-precio {
	color: #2e7d32;
	font-weight: bold;
	font-size: 1.2rem;
	margin-left: 18px;
}
.carrito-ahorro {
	color: #b30000;
	font-size: 0.95rem;
	margin-left: 8px;
}
.carrito-eliminar {
	color: #b30000;
	margin-left: 12px;
	cursor: pointer;
	font-size: 0.95rem;
	text-decoration: underline;
}
.carrito-resumen {
	max-width: 600px;
	margin: 30px auto 0 auto;
	font-size: 1.1rem;
}
.carrito-botones {
	display: flex;
	gap: 18px;
	justify-content: center;
	margin-top: 30px;
	margin-bottom: 80px;
}
.carrito-boton {
	padding: 12px 28px;
	border-radius: 12px;
	font-size: 1.1rem;
	font-weight: bold;
	border: none;
	cursor: pointer;
	transition: background 0.2s;
}
.carrito-boton.vaciar { background: #b30000; color: #fff; }
.carrito-boton.comprar { background: #e65100; color: #fff; }
.carrito-boton.enviar { background: #2e7d32; color: #fff; }
.carrito-boton.vaciar:hover { background: #800000; }
.carrito-boton.comprar:hover { background: #b36b00; }
.carrito-boton.enviar:hover { background: #1b5e20; }
</style>

<div class="pedido-titulo"><i>ðŸ§¾</i> Tu Pedido</div>
<div id="carrito-lista"></div>
<div class="carrito-resumen" id="carrito-resumen"></div>
<div class="carrito-botones">
	<button class="carrito-boton vaciar" onclick="vaciarCarrito()">ðŸ§¹ Vaciar lista</button>
	<button class="carrito-boton comprar" onclick="window.location.href='/'">ðŸ›’ Seguir comprando</button>
	<button class="carrito-boton enviar" onclick="enviarPedido()">âœ… Enviar Pedido</button>
</div>
<script>
function mostrarCarrito() {
		let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
		let contenedor = document.getElementById('carrito-lista');
		let resumen = document.getElementById('carrito-resumen');
		let total = 0, ahorro = 0, puntos = 0;
		if (carrito.length === 0) {
				contenedor.innerHTML = '<p style="text-align:center;">Tu carrito estÃ¡ vacÃ­o.</p>';
				resumen.innerHTML = '';
				return;
		}
		let html = '';
		carrito.forEach((p, idx) => {
				let subtotal = p.precio * p.cantidad;
				let ahorroItem = (p.precio_original && p.precio_original > p.precio) ? (p.precio_original - p.precio) * p.cantidad : 0;
				let puntosItem = p.puntos ? p.puntos * p.cantidad : 0;
				total += subtotal;
				ahorro += ahorroItem;
				puntos += puntosItem;
				html += `<div class='carrito-item'>
						<div class='carrito-nombre'>${p.nombre}</div>
						<div class='carrito-cantidad'>
								<button onclick="modificarCantidad(${idx},-1)">â€“</button>
								<span>${p.cantidad}</span>
								<button onclick="modificarCantidad(${idx},1)">+</button>
						</div>
						<div>
								<span class='carrito-precio'>$${subtotal.toFixed(2)}</span>`;
				if (ahorroItem > 0) {
						html += `<div class='carrito-ahorro'>Ahorra $${ahorroItem.toFixed(2)}</div>`;
				}
				html += `<span class='carrito-eliminar' onclick="eliminarItem(${idx})">Eliminar</span>
						</div>
				</div>`;
		});
		contenedor.innerHTML = html;
		let resumenHtml = `<div>Total: <b>$${total.toFixed(2)}</b></div>`;
		if (ahorro > 0) resumenHtml += `<div>Ahorro: <b>$${ahorro.toFixed(2)}</b></div>`;
		if (puntos > 0) resumenHtml += `<div>Esta compra genera: <b>${puntos} pts</b></div>`;
		resumen.innerHTML = resumenHtml;
}

function modificarCantidad(idx, cambio) {
		let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
		if (!carrito[idx]) return;
		carrito[idx].cantidad += cambio;
		if (carrito[idx].cantidad <= 0) {
				carrito.splice(idx, 1);
		}
		localStorage.setItem('carrito', JSON.stringify(carrito));
		mostrarCarrito();
		if (typeof actualizarBotonCarrito === 'function') actualizarBotonCarrito();
}

function eliminarItem(idx) {
		let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
		carrito.splice(idx, 1);
		localStorage.setItem('carrito', JSON.stringify(carrito));
		mostrarCarrito();
		if (typeof actualizarBotonCarrito === 'function') actualizarBotonCarrito();
}

function vaciarCarrito() {
		localStorage.removeItem('carrito');
		mostrarCarrito();
		if (typeof actualizarBotonCarrito === 'function') actualizarBotonCarrito();
}

function enviarPedido() {
		window.location.href = '/checkout';
}

document.addEventListener('DOMContentLoaded', mostrarCarrito);
</script>
{% endblock %}
